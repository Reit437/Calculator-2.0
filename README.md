# Calculator-2.0

Этот проект представляет собой простой API калькулятора, написанный на Go. API позволяет выполнять базовые арифметические операции над математическими выражениями.
    
## Как это всё работает?

1. Пользователь вводит выражение
2. Выражение попадает в Оркестратор, а он дает его CalculateHandler
3. CalculateHandler вызывает функцию Calc и дает ей выражение
4. CalculateHandler получает обратно мапу, где ключ - id подвыражения, а значение - само подвыражение
5. CalculateHandler отправляет пользователю id последнего подвыражения, формирует задачи для Агента и запускает его
6. Агент запускается сразу в нескольких горутинах, каждая горутина берет задание и решает его, если в операнде есть id, то заменить его значением из мапы(подробнее ниже)
7. Агент отправляет результаты в Оркестратор в ResultHandler
8. ResulHandler уведомляет пользователя, что выражение решено
Пользователь может в процессе вычисления (или после него) запрашивать как весь список подвыражений, так и одно подвыражение по его id(как запускать проект рассказано ниже
)
## Подробнее о работе API

Здесь будет рассказано о некоторых моментах работы API
### Разбиение на подвыражения функцией Calc
Функция Calc запрашивается CalculateHandler, проводит главные проверки на ошибки в записи выражения и самое главное разбивает все выражение на подвыражения.
![Работа Calc](/images/Calc.jpg)
Выражение разбивается на подзадачи. Подзадаче "операнд1 операция операнд2" присваивается id("id"+порядковый номер подзадачи), на который и заменяется подзадача в выражении. Подзадача и ее id добавляются в мапу mapid, в CalculateHandler возвращается эта самая мапа.
### Паралельное решение подзадач Агентом
Так как у нас есть ограничение на количество запущенных горутин, то нам надо в случае не хватки изначального количества их, запустить новые, но опять не больше установленного значения.
![Agent func main()](/images/Agent_func_main().jpg)
Но как решать подзадачи где какой-либо из операндов с "id"? Для этого результат каждой подзадачи помимо отправки в Оркестратор ResultHandler сохраняется в мапе valmap.
![Agent func Agent()](/images/Agent_func_Agent().jpg)
